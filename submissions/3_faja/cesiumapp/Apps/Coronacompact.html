<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Use correct character set. -->
  <meta charset="utf-8">

  <!-- Make the application on mobile take up the full browser screen and disable user scaling. -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=yes">
  <title>Corona Compact</title>
  <script src="../Build/Cesium/Cesium.js"></script> 
  <style>
      @import url(../Build/Cesium/Widgets/widgets.css);
      html, body, #cesiumContainer {
          width: 100%; height: 100%; margin: 0; padding: 0; overflow: hidden;
      }
	  #image{
	  width:102%;
	  
	  }
	  #scan{
	  background-color:#4CAF50;
	  }
	  
  </style>
</head>

<body background="../images/blue.png">

<div id="menu">
    <div id="overlay"></div>
    <img id="image" src="../images/overlay1.png">

<button class="cesium-button cesium-button-toolbar" onClick="buttonsbrightness()">Brightmap</button>
<button class="cesium-button cesium-button-toolbar" onClick="buttonsnight()">Nightlights</button>
<button class="cesium-button cesium-button-toolbar" onClick="zoomin()">+</button>
<button class="cesium-button cesium-button-toolbar" onClick="zoomout()">-</button>
<button class="cesium-button cesium-button-toolbar" onClick="rotateLeft()"> <- </button>
<button class="cesium-button cesium-button-toolbar" onClick="rotateRight()"> -> </button>
<button class="cesium-button cesium-button-toolbar" onClick="rotateUp()"> Down </button>
<button class="cesium-button cesium-button-toolbar" onClick="rotateDown()"> Up </button>
<button class="cesium-button cesium-button-toolbar" id = "scan" onClick="doGeocoding(0)">Scan!</button>
</div>
  <div id="cesiumContainer"></div>
  <script>

  
  //window.projectname='';
    window.locationflag = false;
  window.mapflag = false;
  window.previousgeocode;
     // var viewer = new Cesium.Viewer('cesiumContainer');
	var viewer = new Cesium.Viewer('cesiumContainer', {
    imageryProvider : new Cesium.ArcGisMapServerImageryProvider({
        url : 'https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer'
    }),
    baseLayerPicker : false
});
		
var layers = viewer.imageryLayers;
var blackMarble = layers.addImageryProvider(Cesium.createTileMapServiceImageryProvider({
    url : 'https://cesiumjs.org/blackmarble',
    credit : 'Black Marble imagery courtesy NASA Earth Observatory',
    flipXY : true 
}));



	  	 var scene = viewer.scene;
		 
		// scene.screenSpaceCameraController.enableCollisionDetection=false;
	     scene.screenSpaceCameraController.enableTilt=false;
		 
		 scene.screenSpaceCameraController.minimumZoomDistance =  2800000;
		 scene.screenSpaceCameraController.maximumZoomDistance = 29000000;
		 
		var camera = viewer.camera;
		camera.minimumZoomDistance =  2500000;
		camera.maximumZoomDistance = 29000000;
		 function zoomin(){
		 
		 viewer.camera.zoomIn(1000000.0);
		 }
		  function zoomout(){
		 
		 viewer.camera.zoomOut(1000000.0);
		 }
		 function rotateLeft(){
		 viewer.camera.rotateLeft(0.2);
		 }
		 function rotateRight(){
		 viewer.camera.rotateRight(0.2);
		 }
		  function rotateUp(){
		 viewer.camera.rotateUp(0.1);
		 }
		 function rotateDown(){
		 viewer.camera.rotateDown(0.1);
		 }
		 
		 
  function  buttonsbrightness()
{
blackMarble.alpha = 0.5;
blackMarble.brightness = 2.0;
}  
  function  buttonsnight()
{
blackMarble.alpha = 1;
blackMarble.brightness = 1;
}  

		 
		  
	
   fetch('https://api.topcoder.com/v4/looks/343/run/json/').then(response=>{
return response.json();}).then(function(objA){ 
var lokacije = [];
for(var i=0;i<objA.length;i++){
var country = objA[i]['submitter_country.country_name']
  var city = objA[i]['submitter.city']; 
 
      var location = country +' , '+city;
	  lokacije.push(location); 
 }   
 window.locations = lokacije;
 window.locationflag = true;
 console.log(window.locations);
});

var geocodes=[];
function doGeocoding(startIndex){
console.log(startIndex);
if(window.locationflag==true){
for(var i = startIndex;i<startIndex+10;i++){
if(i>window.locations.length){
break;
}else{
var geocoder = new google.maps.Geocoder();
geocoder.geocode( { 'address': window.locations[i]}, function(results, status) {
  if (status == google.maps.GeocoderStatus.OK) {   
    var lat = results[0].geometry.location.lat();
    var lon = results[0].geometry.location.lng();
	var geocode = [lat,lon];
 if(lat!=window.previousgeocode){
	geocodes.push(geocode);
	window.previousgeocode = lat;
	console.log(geocode);	
	
	var marker = viewer.entities.add({
        position : Cesium.Cartesian3.fromDegrees(lon, lat),
        billboard :{
            image : '../images/sprite11.png'	,
scaleByDistance : new Cesium.NearFarScalar(1.5e2, 2.0, 1.5e7, 1.0)			
        }
		});					
	 }		
	}
	});		
}
}
if(startIndex<window.locations.length){
	setTimeout(doGeocoding,10000,startIndex+10);
	}
}
}

/*
if(window.locationflag==true){

var address =  window.lokacije;

for(var i = 0;i<address.length;i++){
var geocoder = new google.maps.Geocoder();
geocoder.geocode( { 'address': address[i]}, function(results, status) {
  if (status == google.maps.GeocoderStatus.OK) {   
    var lat = results[0].geometry.location.lat();
    var lon = results[0].geometry.location.lng();

    console.log(latitude+" , "+longitude);

	
					    var wyoming = viewer.entities.add({
        position : Cesium.Cartesian3.fromDegrees(longitude,latitude),
        point : {
            pixelSize : 10,
            color : Cesium.Color.YELLOW
        }
    }); 
	
	viewer.entities.add({
        position : Cesium.Cartesian3.fromDegrees(-75.59777, 40.03883),
        billboard :{
            image : '../images/marker1.png'
        }});
	
				    var elips = viewer.entities.add({
					
        position : Cesium.Cartesian3.fromDegrees(longitude,latitude,900000.0),
        ellipsoid : {
          radii : new Cesium.Cartesian3(97500.0, 97500.0, 97500.0),
            outline : true,
            outlineColor : Cesium.Color.YELLOW,
            outlineWidth : 0.5,
            material : Cesium.Color.fromRandom({alpha : 0.5})
        }
    });    
	
				    var boxes = viewer.entities.add({
					
        position : Cesium.Cartesian3.fromDegrees(longitude,latitude,600000.0),
        box : {
            dimensions : new Cesium.Cartesian3(90000.0, 90000.0, 90000.0),
            outline : true,
            outlineColor : Cesium.Color.WHITE,
            outlineWidth : 1,
            material : Cesium.Color.fromRandom({alpha : 0.5})
        
        }
    });  
	
	
	
	}if(status ==google.maps.GeocoderStatus.OVER_QUERY_LIMIT){
	console.log('over query');
	

  } 
});

 }
 }}
  
  
  
  /*
  
  window.locationflag = false;
  window.mapflag = false;
  
    var viewer = new Cesium.Viewer('cesiumContainer');
   fetch('https://api.topcoder.com/v4/looks/343/run/json/').then(response=>{
return response.json();}).then(function(objA){ 
var lokacije = [];
for(var i=0;i<objA.length;i++){
var country = objA[i]['submitter_country.country_name']
  var city = objA[i]['submitter.city'];                               
  //var noviarray = Object.values(citrus);
 
      var location = country +' , '+city;
	  lokacije.push(location);
	  
	 // console.log(location);
    //  var locationarr = [];
	  //locationarr.unshift(location);
	//console.log(location);
	
	 
 }   
 
 
 window.lokacije = lokacije;
 window.locationflag = true;
 console.log(window.lokacije);
 // document.getElementById('address').innerHTML+=locationarr;
});


function initMap(){


if(window.locationflag==true){

var address =  window.lokacije;

for(var i = 0;i<address.length;i++){
var geocoder = new google.maps.Geocoder();

geocoder.geocode( { 'address': address[i]}, function(results, status) {
 
  if (status == google.maps.GeocoderStatus.OK) {
   
    var latitude = results[0].geometry.location.lat();
    var longitude = results[0].geometry.location.lng();

    console.log(latitude+" , "+longitude);

	
					    var wyoming = viewer.entities.add({
        position : Cesium.Cartesian3.fromDegrees(longitude,latitude),
        point : {
            pixelSize : 10,
            color : Cesium.Color.YELLOW
        }
    }); 
	
	viewer.entities.add({
        position : Cesium.Cartesian3.fromDegrees(-75.59777, 40.03883),
        billboard :{
            image : '../images/marker1.png'
        }});
	
				    var elips = viewer.entities.add({
					
        position : Cesium.Cartesian3.fromDegrees(longitude,latitude,900000.0),
        ellipsoid : {
          radii : new Cesium.Cartesian3(97500.0, 97500.0, 97500.0),
            outline : true,
            outlineColor : Cesium.Color.YELLOW,
            outlineWidth : 0.5,
            material : Cesium.Color.fromRandom({alpha : 0.5})
        }
    });    
	
				    var boxes = viewer.entities.add({
					
        position : Cesium.Cartesian3.fromDegrees(longitude,latitude,600000.0),
        box : {
            dimensions : new Cesium.Cartesian3(90000.0, 90000.0, 90000.0),
            outline : true,
            outlineColor : Cesium.Color.WHITE,
            outlineWidth : 1,
            material : Cesium.Color.fromRandom({alpha : 0.5})
        
        }
    });  
	
	
	
	}if(status ==google.maps.GeocoderStatus.OVER_QUERY_LIMIT){
	console.log('over query');
	

  } 
});

 }
 }}
  
  function to(){
  setTimeout(to,1000);
  }
  
  
/*  
  var viewer = new Cesium.Viewer('cesiumContainer');
   fetch('https://api.topcoder.com/v4/looks/343/run/json/').then(response=>{
return response.json();}).then(function(objA){ 
for(var i=0;i<objA.length;i++){
  var citrus = objA[i];                               
  var noviarray = Object.values(citrus);
 
      var location = noviarray[4]+' '+noviarray[2];
	 // console.log(location);
      var locationarr = [];
	  locationarr.unshift(location);
	console.log(location);
	
	 
 }    document.getElementById('address').innerHTML+=locationarr;
});


function initMap(){
//
// ['Sarajevo','Mostar','Tuzla','travnik','banja luka','visoko','Cape town','Beograd','zagreb','barcelona','venice','rome','london','paris','berlin','prague','moscow','beijing','melbourne']  
var address =  document.getElementById('address').innerHTML;

for(var i = 0;i<address.length;i++){

var geocoder = new google.maps.Geocoder();

geocoder.geocode( { 'address': address[i]}, function(results, status) {
 
  if (status == google.maps.GeocoderStatus.OK) {
   
    var latitude = results[0].geometry.location.lat();
    var longitude = results[0].geometry.location.lng();
	
    console.log(latitude+" "+longitude);

	
				    var wyoming = viewer.entities.add({
        position : Cesium.Cartesian3.fromDegrees(longitude,latitude),
        point : {
            pixelSize : 10,
            color : Cesium.Color.YELLOW
        }
    });    
	
	}if(status ==google.maps.GeocoderStatus.OVER_QUERY_LIMIT){
	console.log('over query')

  } 
});

 }
 }




/*
function initMap(){

var geocoder = new google.maps.Geocoder();
var address = document.getElementById('address').value;
geocoder.geocode( { 'address': address}, function(results, status) {
 
  if (status == google.maps.GeocoderStatus.OK) {
   var j=+1;
    var lati[0] = results[j].geometry.location.lat();
    var lati[1] = results[j].geometry.location.lng();
	
	
    console.log(latitude+" "+longitude);
	
	
			    var wyoming = viewer.entities.add({
        position : Cesium.Cartesian3.fromDegrees(longitude,latitude),
        point : {
            pixelSize : 10,
            color : Cesium.Color.YELLOW
        }
    });    
  } 
});

 }

	


/*
function initMap() {

        var map = new google.maps.Map(document.getElementById('map'), {
         
        });
        var geocoder = new google.maps.Geocoder();

       
          geocodeAddress(geocoder, map);
      
      }

      function geocodeAddress(geocoder, resultsMap) {
	
        var address = document.getElementById('address').value;
        geocoder.geocode({'address': address}, function(results, status) {
          if (status === 'OK') {
		  
             var lati = results[0].geometry.location.lat();		
			 var longi = results[0].geometry.location.lng();  
			 var latlon=lati+', '+longi;
			 
			    var wyoming = viewer.entities.add({
        position : Cesium.Cartesian3.fromDegrees(longi,lati),
        point : {
            pixelSize : 10,
            color : Cesium.Color.YELLOW
        }
    });   

viewer.zoomTo(wyoming);
			 
            console.log(lati+' '+longi);
            
          } else {
            console.log('Geocode was not successful for the following reason: ' + status);
          }
        });
      }

  
 
   /*
   var wyoming = viewer.entities.add({
        position : Cesium.Cartesian3.fromDegrees(finallat,finallong),
        point : {
            pixelSize : 10,
            color : Cesium.Color.YELLOW
        }
    });   

viewer.zoomTo(wyoming);*/
   
   
  </script>
  
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCWG4vQhZ7M-8a1dtjJ8wwQPCsuVrEK2fs">
    </script>
	
</body>
</html>
